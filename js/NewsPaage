
let offset = 12;
const limit = 10;


$(document).ready(function () {

  const loadMoreBtn = $("#load-more-btn");
  const newsContainer = $("#news-container");

  let nombre = 0;
  loadMoreBtn.on("click", function () {
    $.ajax({
      url: `/Project/Api/api.php?getNews=1`,
      method: "GET",
      dataType: "json",
      success: function (data) {
        nombre = data.NumberOfNews;
      },
      error: function (error) {
        console.error("Error fetching news:", error);
      },
    });
    if (newsContainer[0].children.length < nombre) {
      fetchNews();
    }
  });

  function fetchNews() {
    $.ajax({
      url: `/Project/Api/api.php?offset=${offset}&limit=${limit}`,
      method: "GET",
      dataType: "json",
      success: function (data) {
        appendNewsToContainer(data);
        offset = offset + limit;
        console.log("offezfez", offset);
      },
      error: function (error) {
        console.error("Error fetching news:", error);
      },
    });
  }

  function appendNewsToContainer(newsData) {
    $.each(newsData, function (_, newsItem) {
      const newsCard = createNewsCard(newsItem);
      newsContainer.append(newsCard);
    });
  }

  function createNewsCard(newsItem) {
    const card = $("<a>", {
      href: `/Project/news/detail/?id=${newsItem["NewsID"]}`,
      class: "news-card",
    });

    const imageContainer = $("<div>");
    const image = $("<img>", {
      src: `/Project/public/images/${newsItem["ImagePath"]}`,
      alt: "",
    });
    imageContainer.append(image);

    const contentContainer = $("<div>");

    const shortenedTitle =
      newsItem["Title"].length > 32
        ? newsItem["Title"].substring(0, 32) + "..."
        : newsItem["Title"];
    const title = $("<h1>", { text: shortenedTitle });

    let shortenedContent =
      newsItem["Content"].length > 110
        ? newsItem["Content"].substring(0, 110) + "..."
        : newsItem["Content"];

    shortenedContent = shortenedContent.padEnd(110, " ");

    const paragraph = $("<p>", { text: shortenedContent });
    const publishedDate = $("<h3>", {
      text: `Published Â· ${formatDate(newsItem["Date"])}`,
    });

    contentContainer.append(title, paragraph, publishedDate);
    card.append(imageContainer, contentContainer);

    return card;
  }

  function formatDate(dateString) {
    const options = { day: "numeric", month: "short", year: "numeric" };
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", options);
  }
});
